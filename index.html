<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Ukrainian Soldier Ragdoll</title>
  <style>
    html,body{margin:0;padding:0;overflow:hidden;background:#1e2f45;color:white}
    #ui{position:fixed;top:10px;left:10px;font:16px sans-serif;z-index:10}
  </style>
</head>
<body>
<div id="ui">Сальто: <span id="counter">0</span></div>

<script src="https://cdn.jsdelivr.net/npm/pixi.js@7/dist/pixi.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

<script>
const { Engine, World, Bodies, Body, Runner, Constraint } = Matter;

// =====================
// PIXI
// =====================
const app = new PIXI.Application({
  resizeTo: window,
  backgroundColor: 0x1e2f45,
  antialias: true
});
document.body.appendChild(app.view);

// =====================
// LOAD TEXTURES (важливо для GitHub Pages)
// =====================
const loader = new PIXI.Assets;
const ASSETS = {
  torso: "assets/torso_base.png",
  head: "assets/head_base.png",
  lua: "assets/left_upper_arm.png",
  lfa: "assets/left_forearm.png",
  rua: "assets/right_upper_arm.png",
  rfa: "assets/right_forearm.png",
  lt: "assets/left_thigh.png",
  ls: "assets/left_shin.png",
  rt: "assets/right_thigh.png",
  rs: "assets/right_shin.png",
  helmet: "assets/helmet.png",
  vest: "assets/vest.png",
  rifle: "assets/rifle.png"
};

PIXI.Assets.load(Object.values(ASSETS)).then(start);

function start(textures){

// =====================
// Matter
// =====================
const engine = Engine.create();
engine.gravity.y = 1.6;
engine.gravity.scale = 0.001;
Runner.run(Runner.create(), engine);
const world = engine.world;

// =====================
// Ground
// =====================
const groundY = window.innerHeight - 80;
const ground = Bodies.rectangle(window.innerWidth/2, groundY, window.innerWidth, 120, {isStatic:true});
World.add(world, ground);

// =====================
// Bodies
// =====================
const cx = window.innerWidth/2;
const cy = window.innerHeight/2 - 200;

const torso = Bodies.rectangle(cx, cy, 120, 200,{mass:3});
const head = Bodies.circle(cx, cy-150,40,{mass:1});

const lua = Bodies.rectangle(cx-90,cy-20,40,110);
const lfa = Bodies.rectangle(cx-120,cy+60,35,110);

const rua = Bodies.rectangle(cx+90,cy-20,40,110);
const rfa = Bodies.rectangle(cx+120,cy+60,35,110);

const lt = Bodies.rectangle(cx-35,cy+170,45,120);
const ls = Bodies.rectangle(cx-35,cy+290,40,130);

const rt = Bodies.rectangle(cx+35,cy+170,45,120);
const rs = Bodies.rectangle(cx+35,cy+290,40,130);

World.add(world,[torso,head,lua,lfa,rua,rfa,lt,ls,rt,rs]);

// =====================
// Constraints
// =====================
World.add(world,[
  Constraint.create({bodyA:torso,bodyB:head,pointA:{x:0,y:-110},pointB:{x:0,y:40},stiffness:0.6}),

  Constraint.create({bodyA:torso,bodyB:lua,pointA:{x:-70,y:-40},pointB:{x:0,y:-50},stiffness:0.6}),
  Constraint.create({bodyA:lua,bodyB:lfa,pointA:{x:0,y:50},pointB:{x:0,y:-50},stiffness:0.6}),

  Constraint.create({bodyA:torso,bodyB:rua,pointA:{x:70,y:-40},pointB:{x:0,y:-50},stiffness:0.6}),
  Constraint.create({bodyA:rua,bodyB:rfa,pointA:{x:0,y:50},pointB:{x:0,y:-50},stiffness:0.6}),

  Constraint.create({bodyA:torso,bodyB:lt,pointA:{x:-30,y:100},pointB:{x:0,y:-50},stiffness:0.7}),
  Constraint.create({bodyA:lt,bodyB:ls,pointA:{x:0,y:50},pointB:{x:0,y:-60},stiffness:0.7}),

  Constraint.create({bodyA:torso,bodyB:rt,pointA:{x:30,y:100},pointB:{x:0,y:-50},stiffness:0.7}),
  Constraint.create({bodyA:rt,bodyB:rs,pointA:{x:0,y:50},pointB:{x:0,y:-60},stiffness:0.7})
]);

// =====================
// Sprites
// =====================
function sprite(tex){
  const s = new PIXI.Sprite(tex);
  s.anchor.set(0.5);
  app.stage.addChild(s);
  return s;
}

const sTorso = sprite(textures[0]);
const sHead = sprite(textures[1]);
const sLUA = sprite(textures[2]);
const sLFA = sprite(textures[3]);
const sRUA = sprite(textures[4]);
const sRFA = sprite(textures[5]);
const sLT = sprite(textures[6]);
const sLS = sprite(textures[7]);
const sRT = sprite(textures[8]);
const sRS = sprite(textures[9]);
const sHelmet = sprite(textures[10]);
const sVest = sprite(textures[11]);
const sRifle = sprite(textures[12]);

function sync(b,s){ s.x=b.position.x; s.y=b.position.y; s.rotation=b.angle; }

// =====================
// State
// =====================
let state="IDLE", flips=0;
const counter=document.getElementById("counter");

function update(){
  const near=Math.abs(torso.angle)<0.4;
  if(state==="FLIP" && torso.position.y>groundY-140 && near){
    state="IDLE";
    Body.setAngularVelocity(torso,0);
    Body.setAngle(torso,0);
  }
}

// =====================
// Loop
// =====================
app.ticker.add(()=>{
  update();
  sync(torso,sTorso); sync(head,sHead);
  sync(lua,sLUA); sync(lfa,sLFA);
  sync(rua,sRUA); sync(rfa,sRFA);
  sync(lt,sLT); sync(ls,sLS);
  sync(rt,sRT); sync(rs,sRS);

  sHelmet.x=sHead.x; sHelmet.y=sHead.y-10; sHelmet.rotation=sHead.rotation;
  sVest.x=sTorso.x; sVest.y=sTorso.y; sVest.rotation=sTorso.rotation;
  sRifle.x=sRFA.x+40; sRifle.y=sRFA.y; sRifle.rotation=sRFA.rotation;
});

// =====================
// Input
// =====================
app.view.addEventListener("pointerdown",()=>{
  if(state!=="IDLE")return;
  state="FLIP";
  Body.setVelocity(torso,{x:0,y:-26});
  Body.setAngularVelocity(torso,3.2);
  Body.setVelocity(lt,{x:-2,y:-20});
  Body.setVelocity(rt,{x:2,y:-20});
  counter.textContent=++flips;
});

}
</script>
</body>
</html>
